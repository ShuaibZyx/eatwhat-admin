<template>
  <el-card>
    <div class="menu" v-if="admin && admin.menuAuth === 1">
      <div class="title">
        <el-alert title="ËèúË∞±ÁÆ°ÁêÜÁïåÈù¢" type="success" center :closable="false">
        </el-alert>
      </div>
      <div class="btn">
        <el-button
          type="primary"
          size="small"
          round
          icon="el-icon-plus"
          @click="addMenuClick"
          >Ê∑ªÂä†Êñ∞ËèúË∞±</el-button
        >
      </div>
      <div class="table">
        <el-table
          :data="
            menu.filter(
              (data) =>
                !menuSearch ||
                data.menuName.toLowerCase().includes(menuSearch.toLowerCase())
            )
          "
          style="width: 100%"
          fit
          lazy
          :stripe="true"
          :border="true"
          :highlight-current-row="true"
          empty-text="ü•∂Ê≠£Âú®Âä™ÂäõÂä†ËΩΩ‰∏≠..."
        >
          <el-table-column type="expand">
            <template slot-scope="scope">
              <div class="desc">
                <div class="desc-title">
                  <span>ÊèèËø∞‰ø°ÊÅØ:</span>
                </div>
                <div class="brief">{{ scope.row.menuBrief || "ÊöÇÊó†" }}</div>
              </div>
            </template>
          </el-table-column>

          <el-table-column label="ËèúË∞±ÂêçÁß∞" align="center">
            <template slot-scope="scope">
              {{ scope.row.menuName || "Êú™Áü•" }}
            </template>
          </el-table-column>

          <el-table-column label="ÂõæÁâá" align="center">
            <template slot-scope="scope">
              <el-image
                style="width: 100px; height: 100px"
                :src="scope.row.menuPut"
                :preview-src-list="menuImgs"
              >
                <div slot="error" class="image-slot">
                  <i class="el-icon-picture-outline"></i>
                </div>
              </el-image>
            </template>
          </el-table-column>

          <el-table-column label="ÁªÑÊàê" align="center">
            <template slot-scope="scope">
              {{ scope.row.menuEle || "Êú™Áü•" }}
            </template>
          </el-table-column>

          <el-table-column label="Âè£Âë≥" align="center">
            <template slot-scope="scope">
              {{ scope.row.menuTaste || "Êú™Áü•" }}
            </template>
          </el-table-column>

          <el-table-column label="ËèúÁ≥ª" align="center" width="100">
            <template slot-scope="scope">
              {{ scope.row.menuCuis || "Êú™Áü•" }}
            </template>
          </el-table-column>

          <el-table-column label="ÈöæÂ∫¶" align="center">
            <template slot-scope="scope">
              <el-rate
                v-model="scope.row.menuLevel"
                disabled
                text-color="#ff9900"
              >
              </el-rate>
            </template>
          </el-table-column>

          <el-table-column label="‰ª∑Ê†º" align="center" width="100">
            <template slot-scope="scope">
              {{ scope.row.menuPrice }} ÂÖÉ
            </template>
          </el-table-column>

          <el-table-column align="center">
            <template slot="header" slot-scope="scope">
              <el-input
                v-model="menuSearch"
                size="mini"
                placeholder="ËæìÂÖ•ËèúË∞±ÂêçÁß∞ÊêúÁ¥¢"
              />
            </template>
            <template slot-scope="scope">
              <el-button
                type="primary"
                size="mini"
                plain
                @click="showUpdateMenu(scope.row.menuId)"
                >ÁºñËæë</el-button
              >
              <el-popconfirm
                title="Á°ÆÂÆöÂà†Èô§ËØ•ËèúË∞±?Ê≠§Êìç‰Ωú‰∏çÂèØÈÄÜ"
                style="margin-left: 5px"
                @confirm="deleteMenu(scope.row.menuId)"
              >
                <el-button slot="reference" type="danger" size="mini" plain
                  >Âà†Èô§</el-button
                >
              </el-popconfirm>
            </template>
          </el-table-column>
        </el-table>
      </div>
    </div>

    <div v-else>
      <el-result
        icon="warning"
        title="ÊùÉÈôêÊèêÁ§∫"
        subTitle="ÊÇ®Êó†ÊùÉÁÆ°ÁêÜÊ≠§È°π,ËØ∑ÂêëÊúÄÈ´òÁÆ°ÁêÜÂëòÁî≥ËØ∑ÊùÉÈôê"
      >
        <template slot="extra">
          <el-button type="primary" size="medium" @click="$router.push('/')"
            >ËøîÂõû</el-button
          >
        </template>
      </el-result>
    </div>

    <!-- Ê∑ªÂä†ËèúË∞±ÁöÑdialog -->
    <el-dialog
      title="Ê∑ªÂä†ËèúË∞±"
      :visible.sync="addMenuDialogVisible"
      width="40%"
      :center="true"
      @close="addMenuDialogClosed"
    >
      <el-form
        :model="addMenuForm"
        label-width="80px"
        size="small"
        ref="addMenuFormRef"
        :rules="addMenuFormRules"
      >
        <el-form-item label="ËèúË∞±ÂêçÁß∞" prop="menuName">
          <el-input
            prefix-icon="el-icon-food"
            v-model="addMenuForm.menuName"
            autocomplete="off"
            maxlength="50"
            :clearable="true"
          ></el-input>
        </el-form-item>

        <el-form-item label="ËèúË∞±ÁªÑÊàê">
          <el-tag
            style="margin: 5px"
            :key="tag"
            v-for="tag in dynamicIngredientTags"
            closable
            :disable-transitions="false"
            @close="handleIngredientClose(tag)"
          >
            {{ tag }}
          </el-tag>
          <el-input
            class="input-new-tag"
            v-if="inputIngredientVisible"
            v-model="inputIngredientValue"
            ref="saveTagInput"
            size="small"
            @keyup.enter.native="handleInputConfirm"
            @blur="handleInputConfirm"
          >
          </el-input>
          <el-button
            v-else
            class="button-new-tag"
            size="small"
            @click="showInput"
            >+ ÂéüÊñô</el-button
          >
        </el-form-item>

        <el-form-item label="È¢Ñ‰º∞‰ª∑Ê†º" prop="menuPrice">
          <el-input
            v-model.number="addMenuForm.menuPrice"
            autocomplete="off"
            prefix-icon="el-icon-wallet"
            :clearable="true"
            maxlength="5"
          >
            <i slot="suffix">ÂÖÉ</i>
          </el-input>
        </el-form-item>

        <el-form-item label="ËèúË∞±Âè£Âë≥" prop="menuTaste">
          <el-select
            v-model="addMenuForm.menuTaste"
            filterable
            clearable
            placeholder="ËØ∑ÈÄâÊã©ËèúË∞±Âè£Âë≥"
          >
            <el-option
              v-for="item in menuTastes"
              :key="item.value"
              :label="item.label"
              :value="item.value"
            >
            </el-option>
          </el-select>
        </el-form-item>

        <el-form-item label="ËèúË∞±ÂõæÁâá">
          <el-upload
            action="http://121.37.102.50:3006/menu/upload"
            ref="upload"
            :on-change="uploadImg"
            :on-success="uploadImgSuccess"
            accept=".jpeg,.png,.jpg,.bmp,.gif"
            list-type="picture"
            :limit="1"
            :disabled="uploadImgBtnVisible"
          >
            <el-button
              v-show="!uploadImgBtnVisible"
              size="small"
              type="primary"
              plain
              round
              >ÈÄâÊã©ÂõæÁâá</el-button
            >
          </el-upload>
        </el-form-item>

        <el-form-item label="ËèúË∞±ËèúÁ≥ª" prop="menuCuis">
          <el-select
            v-model="addMenuForm.menuCuis"
            filterable
            clearable
            placeholder="ËØ∑ÈÄâÊã©ËèúË∞±ËèúÁ≥ª"
          >
            <el-option
              v-for="item in menuCuis"
              :key="item.value"
              :label="item.label"
              :value="item.value"
            >
            </el-option>
          </el-select>
        </el-form-item>

        <el-form-item label="‰∏äÊâãÈöæÂ∫¶" prop="menuLevel">
          <el-input
            v-model.number="addMenuForm.menuLevel"
            autocomplete="off"
            prefix-icon="el-icon-star-off"
            :clearable="true"
            maxlength="1"
          >
          </el-input>
        </el-form-item>

        <el-form-item label="ËèúË∞±ÁÆÄ‰ªã">
          <el-input
            type="textarea"
            :rows="4"
            v-model.number="addMenuForm.menuBrief"
            autocomplete="off"
            prefix-icon="el-icon-star-off"
            :clearable="true"
            minlength="1"
            maxlength="255"
            show-word-limit
          >
          </el-input>
        </el-form-item>
      </el-form>
      <div slot="footer" class="dialog-footer">
        <el-button
          @click="addMenuDialogVisible = false"
          round
          plain
          size="small"
          type="info"
          >Âèñ Ê∂à</el-button
        >
        <el-button type="primary" @click="addMenu" round plain size="small"
          >Á°Æ ÂÆö</el-button
        >
      </div>
    </el-dialog>

    <!-- Êõ¥Êñ∞ËèúË∞±‰ø°ÊÅØÁöÑdialog -->
    <el-dialog
      title="Êõ¥Êñ∞ËèúË∞±‰ø°ÊÅØ"
      :visible.sync="updateMenuDialogVisible"
      width="40%"
      :center="true"
    >
      <el-form
        :model="updateMenuForm"
        label-width="80px"
        size="small"
        ref="updateMenuFormRef"
        :rules="addMenuFormRules"
      >
        <el-form-item label="ËèúË∞±ÂêçÁß∞" prop="menuName">
          <el-input
            prefix-icon="el-icon-food"
            v-model="updateMenuForm.menuName"
            autocomplete="off"
            maxlength="50"
            :clearable="true"
          ></el-input>
        </el-form-item>

        <el-form-item label="ËèúË∞±ÁªÑÊàê">
          <el-tag
            style="margin: 5px"
            :key="tag"
            v-for="tag in dynamicIngredientTags"
            closable
            :disable-transitions="false"
            @close="handleIngredientClose(tag)"
          >
            {{ tag }}
          </el-tag>
          <el-input
            class="input-new-tag"
            v-if="inputIngredientVisible"
            v-model="inputIngredientValue"
            ref="saveTagInput"
            size="small"
            @keyup.enter.native="handleInputConfirm"
            @blur="handleInputConfirm"
          >
          </el-input>
          <el-button
            v-else
            class="button-new-tag"
            size="small"
            @click="showInput"
            >+ ÂéüÊñô</el-button
          >
        </el-form-item>

        <el-form-item label="È¢Ñ‰º∞‰ª∑Ê†º" prop="menuPrice">
          <el-input
            v-model.number="updateMenuForm.menuPrice"
            autocomplete="off"
            prefix-icon="el-icon-wallet"
            :clearable="true"
            maxlength="5"
          >
            <i slot="suffix">ÂÖÉ</i>
          </el-input>
        </el-form-item>

        <el-form-item label="ËèúË∞±Âè£Âë≥" prop="menuTaste">
          <el-select
            v-model="updateMenuForm.menuTaste"
            filterable
            clearable
            placeholder="ËØ∑ÈÄâÊã©ËèúË∞±Âè£Âë≥"
          >
            <el-option
              v-for="item in menuTastes"
              :key="item.value"
              :label="item.label"
              :value="item.value"
            >
            </el-option>
          </el-select>
        </el-form-item>

        <el-form-item label="ËèúË∞±ÂõæÁâá">
          <el-upload
            action="http://121.37.102.50:3006/menu/upload"
            ref="updateUpload"
            :on-change="uploadImg"
            :on-success="updateImgSuccess"
            accept=".jpeg,.png,.jpg,.bmp,.gif"
            list-type="picture"
            :limit="1"
            :disabled="uploadImgBtnVisible"
          >
            <el-button
              v-show="!uploadImgBtnVisible"
              size="small"
              type="primary"
              plain
              round
              >ÈÄâÊã©ÂõæÁâá</el-button
            >
          </el-upload>
        </el-form-item>

        <el-form-item label="ËèúË∞±ËèúÁ≥ª" prop="menuCuis">
          <el-select
            v-model="updateMenuForm.menuCuis"
            filterable
            clearable
            placeholder="ËØ∑ÈÄâÊã©ËèúË∞±ËèúÁ≥ª"
          >
            <el-option
              v-for="item in menuCuis"
              :key="item.value"
              :label="item.label"
              :value="item.value"
            >
            </el-option>
          </el-select>
        </el-form-item>

        <el-form-item label="‰∏äÊâãÈöæÂ∫¶" prop="menuLevel">
          <el-input
            v-model.number="updateMenuForm.menuLevel"
            autocomplete="off"
            prefix-icon="el-icon-star-off"
            :clearable="true"
            maxlength="1"
          >
          </el-input>
        </el-form-item>

        <el-form-item label="ËèúË∞±ÁÆÄ‰ªã">
          <el-input
            type="textarea"
            :rows="4"
            v-model.number="updateMenuForm.menuBrief"
            autocomplete="off"
            prefix-icon="el-icon-star-off"
            :clearable="true"
            minlength="1"
            maxlength="255"
            show-word-limit
          >
          </el-input>
        </el-form-item>
      </el-form>
      <div slot="footer" class="dialog-footer">
        <el-button
          @click="updateMenuDialogVisible = false"
          round
          plain
          size="small"
          type="info"
          >Âèñ Ê∂à</el-button
        >
        <el-button type="primary" @click="updateMenu" round plain size="small"
          >Á°Æ ÂÆö</el-button
        >
      </div>
    </el-dialog>
  </el-card>
</template>

<script>
export default {
  name: "Menu",
  data() {
    return {
      menu: [],
      menuSearch: "",
      menuImgs: [],

      //Ê∑ªÂä†Êñ∞ËèúË∞±ÁöÑdialogÂØπËØùÊ°ÜÂèØËßÅÊÄß
      addMenuDialogVisible: false,
      //Êõ¥Êñ∞ËèúË∞±‰ø°ÊÅØÁöÑdialogÂØπËØùÊ°ÜÂèØËßÅÊÄß
      updateMenuDialogVisible: false,
      inputIngredientVisible: false,
      //Ê∑ªÂä†ÂõæÁâáÊåâÈíÆÁöÑÂèØËßÅÊÄß
      uploadImgBtnVisible: false,

      //Ê∑ªÂä†Êñ∞ËèúË∞±ÁöÑÂØπË±°
      addMenuForm: {
        menuName: "",
        menuId: "",
        menuEle: "",
        menuTaste: "",
        menuCuis: "",
        menuBrief: "",
        menuLevel: "",
        menuPut: "",
        menuPrice: "",
      },

      //Êõ¥Êñ∞ËèúË∞±ÁöÑÂØπË±°
      updateMenuForm: {
        menuName: "",
        menuId: "",
        menuEle: "",
        menuTaste: "",
        menuCuis: "",
        menuBrief: "",
        menuLevel: "",
        menuPut: "",
        menuPrice: "",
      },

      //Ê∑ªÂä†ËèúË∞±Ë°®ÂçïÈ™åËØÅËßÑÂàô
      addMenuFormRules: {
        menuName: [
          { required: true, message: "ËØ∑ËæìÂÖ•ËèúË∞±ÂêçÁß∞", trigger: "blur" },
          {
            min: 1,
            max: 50,
            message: "ÈïøÂ∫¶Âú® 1 Âà∞ 50 ‰∏™Â≠óÁ¨¶",
            trigger: "blur",
          },
        ],
        menuTaste: [
          { required: true, message: "ËØ∑ËæìÂÖ•ËèúË∞±Âè£Âë≥", trigger: "blur" },
          {
            min: 1,
            max: 50,
            message: "ÈïøÂ∫¶Âú® 1 Âà∞ 50 ‰∏™Â≠óÁ¨¶",
            trigger: "blur",
          },
        ],
        menuCuis: [
          { required: true, message: "ËØ∑ËæìÂÖ•ËèúË∞±ËèúÁ≥ª", trigger: "blur" },
          {
            min: 1,
            max: 10,
            message: "ÈïøÂ∫¶Âú® 1 Âà∞ 10 ‰∏™Â≠óÁ¨¶",
            trigger: "blur",
          },
        ],
        menuLevel: [
          { required: true, message: "ËØ∑Â°´ÂÜô‰∏äÊâãÈöæÂ∫¶", trigger: "blur" },
          {
            min: 1,
            max: 5,
            type: "number",
            message: "ÈöæÂ∫¶Âú®1-5È¢ó‚≠ê",
            trigger: "blur",
          },
        ],
        menuPrice: [
          { required: true, message: "ËØ∑Â°´ÂÜôËèúË∞±È¢Ñ‰º∞‰ª∑Ê†º", trigger: "blur" },
          {
            min: 1,
            max: 10000,
            type: "number",
            message: "‰ª∑Ê†ºÂú®1‰∏áÂÖÉ‰ª•‰∏ã",
            trigger: "blur",
          },
        ],
      },

      //ËèúË∞±ÁªÑÊàêÂéüÊñôÊï∞ÁªÑ
      dynamicIngredientTags: [],
      //Êñ∞ÁöÑtagÂêçÂ≠ó
      inputIngredientValue: "",
      //ËèúË∞±Âè£Âë≥Êï∞ÁªÑ
      menuTastes: [
        {
          label: "Áîú",
          value: "Áîú",
        },
        {
          label: "ÈÖ∏",
          value: "ÈÖ∏",
        },
        {
          label: "Ëæ£",
          value: "Ëæ£",
        },
        {
          label: "Âí∏",
          value: "Âí∏",
        },
        {
          label: "ÈÖ∏",
          value: "ÈÖ∏",
        },
        {
          label: "ÈÖ∏Ëæ£",
          value: "ÈÖ∏Ëæ£",
        },
        {
          label: "ÈÖ∏Áîú",
          value: "ÈÖ∏Áîú",
        },
        {
          label: "Ê∏ÖÊ∑°",
          value: "Ê∏ÖÊ∑°",
        },
        {
          label: "Ëã¶Ê∂©",
          value: "Ëã¶Ê∂©",
        },
        {
          label: "È≤úÈ¶ô",
          value: "È≤úÈ¶ô",
        },
      ],
      //ËèúË∞±ËèúÁ≥ªÊï∞ÁªÑ
      menuCuis: [
        {
          label: "Â∑ùÊπòËèú",
          value: "Â∑ùÊπòËèú",
        },
        {
          label: "È≤ÅËèú",
          value: "È≤ÅËèú",
        },
        {
          label: "‰∏úÂåóËèú",
          value: "‰∏úÂåóËèú",
        },
        {
          label: "Ë•øÂåóËèú",
          value: "Ë•øÂåóËèú",
        },
        {
          label: "Á≤§Ëèú",
          value: "Á≤§Ëèú",
        },
        {
          label: "ÂæΩËèú",
          value: "ÂæΩËèú",
        },
        {
          label: "Ë•øÈ§ê",
          value: "Ë•øÈ§ê",
        },
        {
          label: "‰∏ªÈ£ü",
          value: "‰∏ªÈ£ü",
        },
      ],
    };
  },
  computed: {
    admin() {
      return this.$store.state.admin;
    },
  },
  methods: {
    //Ëé∑ÂèñÊâÄÊúâËèúË∞±
    async getMenu() {
      const { data: menuRes } = await this.$http.get("menu");
      this.menu = menuRes.data;
      //Â≠òÂÖ•Êï∞ÁªÑÂõæÁâáÔºåÁî®‰∫éÊü•ÁúãÂ§ßÂõæ
      menuRes.data.forEach((item) => {
        this.menuImgs.push(item.ingrePut);
      });
      console.log(this.menu)
    },

    //ÂÖ≥Èó≠Êñ∞Âä†ËèúË∞±ÁöÑdialogÂØπËØùÊ°ÜÊó∂Ëß¶Âèë
    addMenuDialogClosed() {
      this.$refs.addMenuFormRef.resetFields();
      this.addMenuForm.menuPut = "";
      this.uploadImgBtnVisible = false;
    },

    //Â§ÑÁêÜÂéüÊñôtagÂÖ≥Èó≠‰∫ã‰ª∂
    handleIngredientClose(tag) {
      this.dynamicIngredientTags.splice(
        this.dynamicIngredientTags.indexOf(tag),
        1
      );
    },

    //Â§ÑÁêÜÂØπ‰∫étagÂõûËΩ¶‰∫ã‰ª∂ÊàñÂ§±ÂéªÁÑ¶ÁÇπÁöÑÊñπÊ≥ïÔºåÊ∑ªÂä†Êñ∞ÁöÑËèúË∞±ÂéüÊñô
    handleInputConfirm() {
      let inputValue = this.inputIngredientValue;
      if (inputValue) {
        this.dynamicIngredientTags.push(inputValue);
      }
      this.inputIngredientVisible = false;
      this.inputIngredientValue = "";
    },

    //ÁÇπÂáªÊñ∞+ÂéüÊñô‰∫ã‰ª∂Ëß¶ÂèëÊñπÊ≥ï
    showInput() {
      this.inputIngredientVisible = true;
      this.$nextTick((_) => {
        this.$refs.saveTagInput.$refs.input.focus();
      });
    },

    //‰∏ä‰º†ÂõæÁâáÂâçÈ™åËØÅÊñπÊ≥ï
    uploadImg(file, fileList) {
      if (file.status === "ready") {
        //Êñá‰ª∂Á±ªÂûãÔºåÂè™ËÉΩ‰∏ä‰º†ÂõæÁâá
        const isIMAGE = file.raw.type === "jpeg" || "png" || "jpg";
        //Êñá‰ª∂Â§ßÂ∞èÔºåÂ∞è‰∫é2M
        const isLt1M = file.size / 1024 / 1024 < 2;
        if (!isIMAGE) {
          this.$message.warning("‰∏ä‰º†Êñá‰ª∂Âè™ËÉΩÊòØÂõæÁâáÊ†ºÂºè!");
          fileList.pop();
          return;
        }
        if (!isLt1M) {
          this.$message.warning("‰∏ä‰º†Êñá‰ª∂Â§ßÂ∞è‰∏çËÉΩË∂ÖËøá 2MB!");
          fileList.pop();
          return;
        }
        this.uploadImgBtnVisible = true;
      }
    },

    //Ê∑ªÂä†ËèúË∞±ÂõæÁâá‰∏ä‰º†ÊàêÂäüÁöÑÂõûË∞É
    uploadImgSuccess(response, file, fileList) {
      //Â∞ÜÂõæÁâáË∑ØÂæÑÂ≠òÂÇ®Ëá≥ÂØπË±°‰∏≠
      this.addMenuForm.menuPut = response.data;
      this.$message.success("ÂõæÁâá‰∏ä‰º†ÊàêÂäü,ËØ∑Â°´ÂÜôÂÆåÊàêÂêéÁÇπÂáªÁ°ÆÂÆöÊåâÈíÆ");
    },

    //Êõ¥Êñ∞È£üÊùêÂõæÁâá‰∏ä‰º†ÊàêÂäüÁöÑÂõûË∞É
    updateImgSuccess(response, file, fileList) {
      //Â∞ÜÂõæÁâáË∑ØÂæÑÂ≠òÂÇ®Ëá≥ÂØπË±°‰∏≠
      this.updateMenuForm.menuPut = response.data;
      this.$message.success("ÂõæÁâá‰∏ä‰º†ÊàêÂäü,ËØ∑Â°´ÂÜôÂÆåÊàêÂêéÁÇπÂáªÁ°ÆÂÆöÊåâÈíÆ");
    },

    //Ê∑ªÂä†ËèúË∞±ÊñπÊ≥ï
    addMenu() {
      //Ë°®ÂçïÈ™åËØÅÂºÄÂßã
      this.$refs.addMenuFormRef.validate(async (valid) => {
        //Ë°®ÂçïÈ™åËØÅÂ§±Ë¥•
        if (!valid) {
          this.$message.error("Ê∑ªÂä†Êñ∞ËèúË∞±È™åËØÅÂ§±Ë¥•");
          return;
        }
        //Ê∑ªÂä†ËèúË∞±ÁºñÂè∑
        this.addMenuForm.menuId = this.guid().slice(1, 10);
        //Ê∑ªÂä†ËèúË∞±ÁªÑÊàêÔºå‰ª•|ÂàÜÈöî
        //ËèúË∞±ÁªÑÊàêÂ≠óÁ¨¶‰∏≤
        this.addMenuForm.menuEle = this.dynamicIngredientTags.join("|");
        const { data: addMenuRes } = await this.$http.post(
          "menu",
          this.addMenuForm
        );
        if (addMenuRes.code !== 200) {
          this.$message.error("Ê∑ªÂä†ËèúË∞±Â§±Ë¥•");
          this.getMenu();
          return;
        }
        this.getMenu();
        this.$message.success("Ê∑ªÂä†ËèúË∞±ÊàêÂäüÔºÅ");
        this.dynamicIngredientTags = [];
      });
      this.addMenuDialogVisible = false;
      this.$refs.upload.uploadFiles = [];
      this.uploadImgBtnVisible = false;
    },

    //Âà†Èô§ËèúË∞±ÁöÑÊñπÊ≥ï
    async deleteMenu(menuId) {
      const { data: deleteMenuRes } = await this.$http.delete("menu/" + menuId);
      if (deleteMenuRes.code !== 200) {
        this.$message.error("Âà†Èô§ËèúË∞±Â§±Ë¥•");
        this.getMenu();
        return;
      }
      this.getMenu();
      this.$message.success("Âà†Èô§ËèúË∞±ÊàêÂäü");
    },

    //ÁÇπÂáªÁºñËæëÊåâÈíÆ
    async showUpdateMenu(menuId) {
      const { data: MenuRes } = await this.$http.get("menu/" + menuId);
      this.updateMenuForm = MenuRes.data[0];
      this.dynamicIngredientTags = MenuRes.data[0].menuEle.split("|");
      this.updateMenuDialogVisible = true;
    },

    //Êõ¥Êñ∞ËèúË∞±‰ø°ÊÅØÁöÑÊñπÊ≥ï
    updateMenu() {
      this.$refs.updateMenuFormRef.validate(async (valid) => {
        //Ë°®ÂçïÈ™åËØÅÂ§±Ë¥•
        if (!valid) {
          this.$message.error("Êõ¥Êñ∞ËèúË∞±‰ø°ÊÅØÈ™åËØÅÂ§±Ë¥•");
          return;
        }
        //Ë°®ÂçïÈ™åËØÅÈÄöËøá
        //Â∞ÜËèúË∞±ÁªÑÊàêÂèò‰∏∫Â≠óÁ¨¶‰∏≤Âπ∂ËµãÂÄº
        this.updateMenuForm.menuEle = this.dynamicIngredientTags.join("|");
        const {data: updateMenuRes} = await this.$http.put("menu", this.updateMenuForm);
        if (updateMenuRes.code !== 200) {
          this.$message.error("ÊúçÂä°Âô®ÈîôËØØ Êõ¥Êñ∞Â§±Ë¥•!")
          this.getMenu();
          return;
        }
        this.getMenu();
        this.$message.success("Êõ¥Êñ∞ËèúË∞±‰ø°ÊÅØÊàêÂäü");
      });
      this.updateMenuDialogVisible = false;
      this.$refs.updateUpload.uploadFiles = [];
      this.uploadImgBtnVisible = false;
    },

    //Ëé∑ÂèñÂîØ‰∏ÄidÁöÑÊñπÊ≥ï
    guid() {
      return "xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(
        /[xy]/g,
        function (c) {
          var r = (Math.random() * 16) | 0,
            v = c == "x" ? r : (r & 0x3) | 0x8;
          return v.toString(16);
        }
      );
    },

    addMenuClick() {
      this.addMenuDialogVisible = true;
      this.dynamicIngredientTags = [];
    },
  },
  created() {
    this.getMenu();
  },
};
</script>

<style scoped>
.el-tag + .el-tag {
  margin-left: 10px;
}
.button-new-tag {
  margin-left: 10px;
  height: 32px;
  line-height: 30px;
  padding-top: 0;
  padding-bottom: 0;
}
.input-new-tag {
  width: 90px;
  margin-left: 10px;
  vertical-align: bottom;
}
</style>
